## A Needle in A Haystack

The corresponding Apache log file in this directory has numerous entries, some of which are malicious.
It's all too common to run across log files where you'll have to slice and dice a text file to parse out valuable data.
Sometimes you'll have a nice SIEM to help you query said data, othertimes you'll have to manually parse through logs.
For your first lab, you're tasked to write a script to do the following in the language of your choice:

1. Identify unique count of IPs in this file.
2. Parse out entries that are non-200 status code
3. Perform lookups against a 3rd party API for data enrichment. 
* Is there any historical threat intel?


### Walkthrough Examples
<br />
<details><summary> Bash Example of Unique Count</summary>

```bash
# Get unique IPs
$> cat access.log  | cut -f 1 -d ' ' | uniq -c 
```
</details>


<br />
<details><summary> Bash Example of Querying API </summary>

```bash
# Get unique IPs
uniqueips=$(cat access.log  | cut -f 1 -d ' ' | uniq -c | awk '{print $2}') # create a list of space separated IPs

# query 
for ip in $uniquieips; do
    results=$(curl https://pulsedive.com/api/explore.php?q=$ip) 
    score=$(echo $results | jq '.results|.[].risk')
    countrycode=$(echo $results  | jq '.results|.[].summary.properties.geo.countrycode')
    echo -e "[$(date -Im)] $ip ($countrycode): $score"
    sleep 10;
done
```
</details>


## Hunting in A SIEM
Elasticsearch is an Open Source NoSQL database that is commonly used in industry for log management.
Commerical features support SIEM/Security functionality as well as observability and more featurs.
Kibana is the user interface that queries Elasticsearch for logs. In this scenario we'll setup an Elasticsearch
cluster via docker-compose and upload some log files to begin analyzing the Apache log.

![elk-login](./imgs/00-elk-login.png)
![upload-a-file](./imgs/01-upload-a-file.png)
![elk-login](./imgs/02-import-stats.png)
![import-data](./imgs/03-import-data.png)
![view-data](./imgs/04-view-data.png)
![view-range-of-data](./imgs/05-range-of-data.png)
![filter](./imgs/06-filter-on-specific-values.png)

